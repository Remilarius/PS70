<!DOCTYPE html>
<html lang="en-US">
  <head>
  

  

  <title>
    
    Week 7: Electronic Output Devices | Joy Lin
  </title>

  <meta name="title" content="Week 7: Electronic Output Devices | Joy Lin">

  <meta charset="utf-8">
  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <base href="https://remilarius.github.io/PS70/">

  <meta name="description" content="osprey-delight example site">

  <meta name="author" content="kdevo">

  

  <meta property="og:title" content="Week 7: Electronic Output Devices | Joy Lin">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://remilarius.github.io/PS70/">

  <meta property="og:image" content="https://remilarius.github.io/PS70//images/osprey-delight.png">

  <meta property="og:description" content="osprey-delight example site">

  <link rel="icon" type="image/png" href="anchoricon.png">

  <meta name="theme-color" content="#0097a7">

  <link rel="canonical" href="https://remilarius.github.io/PS70/blog/week-7/">
  
  

  <link rel="stylesheet" href="https://remilarius.github.io/PS70/style.8bf9e65afd7249b538482c017b52bc4aab6c35fb771c80a22694935428991e48.css" type="text/css">

  <script type="application/ld+json">
  {"@context":"http://www.schema.org","@type":"Person","@id":"https://remilarius.github.io/PS70/","name":"kdevo","url":"https://remilarius.github.io/PS70/","description":"osprey-delight example site","sameAs":["","https://github.com/Remilarius","","",""]}
  </script>

  <style>.lazyload{opacity:.0001;}.logo .lazyload{min-width:10em;}</style>
    <script src="https://remilarius.github.io/PS70/js/vendor/lazysizes.min.js" async></script>
</head>

  <body>
    



<nav class="row middle-xs center-xs">
  <div class="col-xs-6 col-sm-1 logo">
    <a href="/PS70/#"><img data-src="anchoricon.png" class="lazyload" lazyload="on" alt="Joy Lin"></a>
  </div>
    
      <div class="col-xs-3 col-sm-2 nav-item">
        <h3><a href="/PS70/#about">About</a></h3>
      </div>
    
      <div class="col-xs-3 col-sm-2 nav-item">
        <h3><a href="/PS70/#work">Work</a></h3>
      </div>
    
      <div class="col-xs-3 col-sm-2 nav-item">
        <h3><a href="/PS70/#blog">Blog</a></h3>
      </div>
    
      <div class="col-xs-3 col-sm-2 nav-item">
        <h3><a href="/PS70/#contact">Contact</a></h3>
      </div>
    
  <div class="col-xs-6 col-sm-1 nav-toggle">
      <a href="" class="nav-icon" onclick="return false">
        <i id="open" class="icon icon-2x icon-menu"></i>
      </a>
  </div>
</nav>

<section class="nav-full row middle-xs center-xs">
  <div class="col-xs-12">
    <div class="row middle-xs center-xs">
      
        <div class="col-xs-12"><h1><a href="/PS70/#about">About</a></h1></div>
      
        <div class="col-xs-12"><h1><a href="/PS70/#work">Work</a></h1></div>
      
        <div class="col-xs-12"><h1><a href="/PS70/#blog">Blog</a></h1></div>
      
        <div class="col-xs-12"><h1><a href="/PS70/#contact">Contact</a></h1></div>
      
    </div>
  </div>
</section>

    <main>

      <section class="container">
        <section class="content">
          <h1> Week 7: Electronic Output Devices </h1>

            <div class="sub-header">
              March 7, 2021 Â· 4 minutes read
            </div>

          <article class="entry-content">
            <p>Still messing the microphone and TFT display, but in the meantime I had seperately accomplish this goal with other equipment actually.</p>
<p>The BNO085 is an IMU that can be connected to an Arduino, like MKRZero or Wifi 1010, and it&rsquo;s an accelerometer like the one in our kit. It can read the XYZ or roll, pitch, yaw of the board to determine the orientation and outputs the information to a serial monitor.</p>
<p><img src="BNO085.jpg" alt="BNO085"></p>
<p>This code takes that input and control the motors of a quadcopter to stabilize its flight. When any of the axes exceed a certain angle, it turns on the motors in that axis.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">
// Sketch for reading the Euler angles from the BNO085, and change drone motors ** Credits to ES 50 Lab 6

#include <span class="p">&lt;</span><span class="nt">Adafruit_BNO08x.h</span><span class="p">&gt;</span> // Include this line to be able to use the Adafruit_BNO08x.h library

#define BNO08X_RESET -1

Adafruit_BNO08x  bno08x(BNO08X_RESET); // Initialize the BNO08x object that we will use to read the IMU
sh2_SensorValue_t sensorValue; // Create the variable that will store the incoming sensor data from the IMU
float eulerAngles[3]; // Create an array for storing the angles around each axis: index 0 for x (roll), 1 for y (pitch), 2 for z (yaw)

int EN5 = 5;                 // Motor Pin
int EN4 = 4;                 // Motor Pin
int EN3 = 3;                 // Motor Pin
int EN2 = 2;                 // Motor Pin

void setup()

{
  pinMode(EN5, OUTPUT);   // where the motor is connected to
  pinMode(EN2, OUTPUT);   // where the motor is connected to
  pinMode(EN3, OUTPUT);   // where the motor is connected to
  pinMode(EN4, OUTPUT);   // where the motor is connected to
    
  Serial.begin(115200);
  
  Serial.println(&#34;Adafruit BNO08x test!&#34;);

  // Attempt to initialize the BNO085, if it fails enter an infinite loop
  if (!bno08x.begin_I2C()) {
    Serial.println(&#34;Failed to find BNO08x chip&#34;);
    while (1) {
      delay(10);
    }
  }
  Serial.println(&#34;BNO08x Found!&#34;);

  // See definition of setReports() below
  setReports();

  Serial.println(&#34;Reading events&#34;);
  delay(100);
}

void setReports(void) {
  Serial.println(&#34;Setting desired reports&#34;);
  if (! bno08x.enableReport(SH2_GAME_ROTATION_VECTOR)) {
    Serial.println(&#34;Could not enable game vector&#34;);
  }
}


void loop() {
  delay(10);

  // This if statement just checks every loop if the sensor was reset,
  // which can be useful if the sensor is ever disconnected accidentally.
  // In that case, this if statement will be entered and the reports will be re-initialized
  if (bno08x.wasReset()) {
    Serial.print(&#34;sensor was reset &#34;);
    setReports();
  }

  // This checks if the values stored in sensorValue have been updated
  if (! bno08x.getSensorEvent(<span class="err">&amp;</span>sensorValue)) {
    return;
  }

  // This if statement checks if the sensorValue that has been updated
  // is the game rotation vector
  if (sensorValue.sensorId == SH2_GAME_ROTATION_VECTOR) {
      toEuler(eulerAngles, sensorValue);

// ******* STUDENT CODE ************

      Serial.print(&#34;roll:&#34;);
      Serial.print(eulerAngles[0]);
      Serial.print(&#34; pitch:&#34;);
      Serial.print(eulerAngles[1]);
      Serial.print(&#34; yaw:&#34;);
      Serial.println(eulerAngles[2]);

// ********* If roll or yaw is over 80 deg or less than -80 deg spin specific motors 
// ********* For some reason the pitch readings were very unreliable

      if (eulerAngles[2] &gt; 80) {
          analogWrite(EN4,0);      //sets the motors speed
          analogWrite(EN2,100);
          analogWrite(EN3,0);
          analogWrite(EN5,0);
          delay(250);
      }
      if (eulerAngles[2] <span class="p">&lt;</span> <span class="nt">-80</span><span class="err">)</span> <span class="err">{</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN4</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>      <span class="err">//</span><span class="na">sets</span> <span class="na">the</span> <span class="na">motors</span> <span class="na">speed</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN2</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN3</span><span class="err">,</span><span class="na">100</span><span class="err">);</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN5</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>
          <span class="na">delay</span><span class="err">(</span><span class="na">250</span><span class="err">);</span>
      <span class="err">}</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">eulerAngles</span><span class="err">[</span><span class="na">0</span><span class="err">]</span> <span class="p">&gt;</span> 80) {
          analogWrite(EN4,100);      //sets the motors speed
          analogWrite(EN2,0);
          analogWrite(EN3,0);
          analogWrite(EN5,0);
          delay(250);
      }
      if (eulerAngles[0] <span class="p">&lt;</span> <span class="nt">-80</span><span class="err">)</span> <span class="err">{</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN4</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>      <span class="err">//</span><span class="na">sets</span> <span class="na">the</span> <span class="na">motors</span> <span class="na">speed</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN2</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN3</span><span class="err">,</span><span class="na">0</span><span class="err">);</span>
          <span class="na">analogWrite</span><span class="err">(</span><span class="na">EN5</span><span class="err">,</span><span class="na">100</span><span class="err">);</span>
          <span class="na">delay</span><span class="err">(</span><span class="na">250</span><span class="err">);</span>
      <span class="err">}</span>
    
  <span class="err">}</span>
<span class="err">}</span>

<span class="na">void</span> <span class="na">toEuler</span><span class="err">(</span><span class="na">float</span> <span class="err">*</span> <span class="na">angles</span><span class="err">,</span> <span class="na">sh2_SensorValue_t</span> <span class="na">quat</span><span class="err">)</span> <span class="err">{</span>
  <span class="na">float</span> <span class="na">w </span><span class="o">=</span> <span class="s">quat.un.gameRotationVector.real;</span>
  <span class="na">float</span> <span class="na">x </span><span class="o">=</span> <span class="s">quat.un.gameRotationVector.i;</span>
  <span class="na">float</span> <span class="na">y </span><span class="o">=</span> <span class="s">quat.un.gameRotationVector.j;</span>
  <span class="na">float</span> <span class="na">z </span><span class="o">=</span> <span class="s">quat.un.gameRotationVector.k;</span>
  <span class="na">float</span> <span class="na">rawAngles</span><span class="err">[</span><span class="na">3</span><span class="err">]</span> <span class="err">=</span> <span class="err">{</span><span class="na">0</span><span class="err">,</span> <span class="na">0</span><span class="err">,</span> <span class="na">0</span><span class="err">};</span> <span class="err">//</span> <span class="na">angles</span> <span class="na">in</span> <span class="na">radians</span>

  <span class="na">float</span> <span class="na">sqw </span><span class="o">=</span> <span class="s">w</span> <span class="err">*</span> <span class="na">w</span><span class="err">;</span>
  <span class="na">float</span> <span class="na">sqx </span><span class="o">=</span> <span class="s">x</span> <span class="err">*</span> <span class="na">x</span><span class="err">;</span>
  <span class="na">float</span> <span class="na">sqy </span><span class="o">=</span> <span class="s">y</span> <span class="err">*</span> <span class="na">y</span><span class="err">;</span>
  <span class="na">float</span> <span class="na">sqz </span><span class="o">=</span> <span class="s">z</span> <span class="err">*</span> <span class="na">z</span><span class="err">;</span>

  <span class="na">rawAngles</span><span class="err">[</span><span class="na">2</span><span class="err">]</span> <span class="err">=</span> <span class="na">atan2</span><span class="err">(</span><span class="na">2</span><span class="err">.</span><span class="na">0</span> <span class="err">*</span> <span class="err">(</span><span class="na">x</span><span class="err">*</span><span class="na">y</span> <span class="err">+</span> <span class="na">z</span><span class="err">*</span><span class="na">w</span><span class="err">),</span> <span class="err">(</span><span class="na">sqx</span> <span class="na">-</span> <span class="na">sqy</span> <span class="na">-</span> <span class="na">sqz</span> <span class="err">+</span> <span class="na">sqw</span><span class="err">));</span>
  <span class="na">rawAngles</span><span class="err">[</span><span class="na">1</span><span class="err">]</span> <span class="err">=</span> <span class="na">asin</span><span class="err">(</span><span class="na">-2</span><span class="err">.</span><span class="na">0</span> <span class="err">*</span> <span class="err">(</span><span class="na">x</span><span class="err">*</span><span class="na">z</span> <span class="na">-</span> <span class="na">y</span><span class="err">*</span><span class="na">w</span><span class="err">)</span> <span class="err">/</span> <span class="err">(</span><span class="na">sqx</span> <span class="err">+</span> <span class="na">sqy</span> <span class="err">+</span> <span class="na">sqz</span> <span class="err">+</span> <span class="na">sqw</span><span class="err">));</span>
  <span class="na">rawAngles</span><span class="err">[</span><span class="na">0</span><span class="err">]</span> <span class="err">=</span> <span class="na">atan2</span><span class="err">(</span><span class="na">2</span><span class="err">.</span><span class="na">0</span> <span class="err">*</span> <span class="err">(</span><span class="na">y</span><span class="err">*</span><span class="na">z</span> <span class="err">+</span> <span class="na">x</span><span class="err">*</span><span class="na">w</span><span class="err">),</span> <span class="err">(</span><span class="na">-sqx</span> <span class="na">-</span> <span class="na">sqy</span> <span class="err">+</span> <span class="na">sqz</span> <span class="err">+</span> <span class="na">sqw</span><span class="err">));</span>
  
  <span class="na">for</span> <span class="err">(</span><span class="na">int</span> <span class="na">i </span><span class="o">=</span> <span class="s">0;</span> <span class="na">i</span> <span class="err">&lt;</span> <span class="na">3</span><span class="err">;</span> <span class="na">i</span><span class="err">++)</span> <span class="err">{</span>
    <span class="na">angles</span><span class="err">[</span><span class="na">i</span><span class="err">]</span> <span class="err">=</span> <span class="na">rawAngles</span><span class="err">[</span><span class="na">i</span><span class="err">]</span> <span class="err">*</span> <span class="err">(</span><span class="na">180</span><span class="err">.</span><span class="na">0</span><span class="err">/</span><span class="na">PI</span><span class="err">);</span> <span class="err">//</span> <span class="na">convert</span> <span class="na">from</span> <span class="na">radians</span> <span class="na">to</span> <span class="na">degrees</span>
  <span class="err">}</span>
<span class="err">}</span></code></pre></div>
          </article>

          <div class="pagination">
            
              <a href="https://remilarius.github.io/PS70/blog/week-6/">&laquo; Week 6: Electronic Input Devices</a>
            
            
              <a href="https://remilarius.github.io/PS70/blog/week-8/">Week 8: Radio Communication &raquo;</a>
            
          </div>
        </section>
        <br>
        <section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname == "localhost")
        return;
      var disqus_shortname = '';
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view comments powered by <a href="http://disqus.com/?ref_noscript">Disqus</a>.</noscript>
</section>

      </section>

    </main>
    <footer class="row middle-xs center-xs">
  <div class="col-xs-2">
      <a target="_blank" rel="noopener" href=""><i class="icon icon-facebook"></i></a>
    </div><div class="col-xs-2">
      <a target="_blank" rel="noopener" href="https://github.com/Remilarius"><i class="icon icon-github"></i></a>
    </div><div class="col-xs-2">
      <a target="_blank" rel="noopener" href=""><i class="icon icon-linkedin"></i></a>
    </div><div class="col-xs-2">
      <a target="_blank" rel="noopener" href=""><i class="icon icon-stackoverflow"></i></a>
    </div><div class="col-xs-2">
      <a target="_blank" rel="noopener" href=""><i class="icon icon-twitter"></i></a>
    </div>
  <div class="col-xs-12">
      <small>
      
      Copyright &copy; 2021 Joy Lin
      
      <div class="col-xs-12">
          <small>Theme: <a href="https://github.com/kdevo/osprey-delight" target="_blank">osprey-delight</a> (fork of <a href="https://github.com/tomanistor/osprey" target="_blank">osprey</a>).</small>
      </div>
      </small>
    </div>
</footer>

    






  <script src="https://remilarius.github.io/PS70/js/bundle.min.39ae3d25b4813183a9708ec4e3146f9eda83dcd89f1f2e0258bc4302e806df7d.js" type="text/javascript"></script>
  <script>handleNavBar( false )</script>

  </body>
</html>